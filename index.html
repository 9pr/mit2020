<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Интегральное исчисление</title>

		<link rel="stylesheet" href="dist/reset.css">
		<link rel="stylesheet" href="dist/reveal.css">
		<link rel="stylesheet" href="dist/theme/league.css" id="theme">

		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="plugin/highlight/monokai.css" id="highlight-theme">
	</head>
	<body>
		<div class="reveal">
			<div class="slides">


				<section class="center" data-markdown data-markdown-separator="^Notes:">
					<script type="text/template">
						Интегральное исчисление
						=======================
					</script>
				</section>

				<section data-markdown data-markdown-separator="^Notes:">
					<script type="text/template">
						Определение первообразной
						-------------------------

						Функция $F(x)$ называется первообразной
						для функции $f(x)$ на данном промежутке, если
						для любого $x$ из данного промежутка 
						$F'(x) = f(x)$.

						Интегрирование функции $f(x)$ - это математическая
						операция по нахождению первообразной $f(x)$.
						
						Notes: Функция эф от икс называется первообразной
						для функци эф от икс на данном промежутке, если
						для любого икс из данного промежутка Эф большое
						от икс равно эф малое от икс
					</script>
				</section>

				<section data-markdown data-markdown-separator="^Notes:">
					<script type="text/template">
						Примеры
						-------------------------

						$F(x) = 5x^3$ - это первобразная для 
						$f(x) = 15x^2$, т.к. $F'(x) = (5x^3)' =
						5 \cdot3x^2 = 15x^2$

						$F(x) = e^x$ - это первобразная для 
						$f(x) = e^x$, т.к. $F'(x) = (e^x)' =
						e^x$

					</script>
				</section>

				<section data-markdown data-markdown-separator="^Notes:">
					<script type="text/template">
						Свойства первообразной
						-------------------------
						- Если к первообразной $F(x)$ функции $f(x)$
						добавить постоянную $C$, то полученная Функция
						$F(x)+C$ также является первобразной для функции
						$f(x)$

						- Первообразная суммы равна сумме первообразных

					</script>
				</section>

				<section data-markdown data-markdown-separator="^Notes:">
					<script type="text/template">
						Неопределённый интеграл
						-------------------------

						Неопределённый интеграл от функции $f(x)$ 
						называется выражение $F(x)+C$, то есть 
						совокупность всех первообразных функции $f(x)$
					</script>
				</section>

				<section data-markdown data-markdown-separator="^Notes:">
					<script type="text/template">
						Неопределённый интеграл
						-------------------------
						Обозначается $\int f(x)dx = F(x)+C$, где
						- $f(x)$ - подытегральная функция
						- $f(x)dx$ - подынтегральное выражение
						- $x$ - переменная интегрирования
						- $F(x)$ - одна из первообразных функции $f(x)$
						- $C$ - постоянная
					</script>
				</section>
				
				<section id="integral-table">
					<aside class="notes">
						Таблица интегралов
					</aside>
				</section>
				
				<section data-markdown data-markdown-separator="^Notes:">
					<script type="text/template">
						Определённый интеграл
						-------------------------

						1. Разобъем промежуток точками 
						$x_0 = a, x_1, x_2, x_3, \cdots, x_k, x_{k+1}, \cdots, x_n=b$
						Введем следующее обозначение: $\Delta x_k = x_{k+1}-x_k$ - длина 
						участка разбиения.
						$\lambda = \sup \{ \Delta x_k \}$ - диаметр разбиения (наибольший
						из всех длин участков разбиения)
					</script>
				</section>
				
				<section data-markdown data-markdown-separator="^Notes:">
					<script type="text/template">
						Определённый интеграл
						-------------------------

						2. На каждом частичном участке $\[x_k; x_{k+1}\]$
						возьмем произвольную точку $\xi_k$ и вычислим в ней
						значение $f(\xi_k)$
						3. Составим произведение $f(\xi_k) \cdot \Delta x_k$
						4. Составим сумму $$\sigma_n = \sum_{k=0}^{n-1} f(\xi_k) 
						\cdot \Delta x_k$$

					</script>
				</section>
				
				<section data-markdown data-markdown-separator="^Notes:">
					<script type="text/template">
						Определённый интеграл
						-------------------------

						5. Измельчая дробление (за счет увеличения числа точек
						дробления $n$) и устремляя при этом диаметр разбиения к
						нулю ($\lambda \rightarrow 0$), найдем предел последовательности
						итегральных сумм $$
						J = \lim_{n \rightarrow \infty, \lambda \rightarrow 0}\sigma_n
						$$

					</script>
				</section>

				<section data-markdown data-markdown-separator="^Notes:">
					<script type="text/template">
						Определённый интеграл
						-------------------------

						Если предел $J$ существует, не зависит от способа
						дробления и выбора точек $\xi_k$, то он называется
						определённым интегралом от функции $f(x)$ по 
						промежутку \[a, b\] и обозначается 
						$$
						J = \int_a^b f(x)dx,
						$$ где $a$ и $b$ называются нижним и верхним
						пределами интегрирования.

					</script>
				</section>

				<section data-markdown data-markdown-separator="^Notes:">
					<script type="text/template">
						Определённый интеграл
						-------------------------

						Более компактное определение определенного интеграла
						записывается, как
						$$
							J = \lim_{n \rightarrow \infty, \lambda \rightarrow 0}
							\sum_{k=0}^{n-1} f(\xi_k) \cdot \Delta x_k
						$$

					</script>
				</section>
				
				<section data-markdown data-markdown-separator="^Notes:">
					<script type="text/template">
						Свойства определённого интеграла
						-------------------------

						- $$
							\int_a^b Af(x)dx = A\int_a^b f(x)dx 
						$$
						- $$
							\int_a^b (f_1(x)+f_2(x))dx = $$
						$$	= \int_a^b f_1(x)dx + \int_a^b f_2(x)dx
						$$
					</script>
				</section>
				
				<section data-markdown data-markdown-separator="^Notes:">
					<script type="text/template">
						Свойства определённого интеграла
						-------------------------

						- $$
							\int_a^b f(x)dx = 
							\int_a^c f(x)dx +
							\int_c^b f(x)dx,
						$$ для любых чисел $ a < c < b$
					</script>
				</section>
				
				<section data-markdown data-markdown-separator="^Notes:">
					<script type="text/template">
						Формула Ньютона-Лейбница
						-------------------------
						Пусть есть непрерывная функция $f(x)$
						на отрезке $[a,b]$, а $F(x)$ её первообразная,
						тогда имеем равенство:
						$$
							\int_a^bf(x)dx = F(b) - F(a)
						$$
					</script>
				</section>
				<section data-markdown data-markdown-separator="^Notes:">
					<script type="text/template">
						Формула Ньютона-Лейбница
						-------------------------
						$$
							\int_1^2x^2dx = \dfrac{2^3}{3} - \dfrac{1^3}{3} =
							\dfrac{8}{3} - \dfrac{1}{3} = \dfrac{7}{3}
						$$
					</script>
				</section>
				
				<section data-markdown data-markdown-separator="^Notes:">
					<script type="text/template">
						Способы вычисления интегралов
						-------------------------

						- Интегрирование элементарных функций (табличных)
						- Интегрирование по частям
						$$
							\int u \cdot dv = uv - \int v \cdot du
						$$
					</script>
				</section>
				
				<section data-markdown data-markdown-separator="^Notes:">
					<script type="text/template">
						Способы вычисления интегралов
						-------------------------
						- Замена переменной

						$\int F(x)dx$. Пусть $x = \phi(t)$, 
							$\phi(t)$ - имеет непрерывную 
							производную. Тогда $dx = \phi(t)'dt$ и
						$ \int F(x)dx = \int F(\phi(t)) \cdot
						\phi'(t)dt$
					</script>
				</section>
				
				<section id="evaluateIntegral">
					<h2>Нахождение интеграла</h2>
					$$\int$$
					<input type="text" id="_function">
					<input type="text" id="_a">
					<input type="text" id="_b">
					$d$ <input type="text" id="_d">
					<input type="button" value="Посчитать" id="_getResult">
					<output id="_result"></output>
				</section>
				
				<section data-markdown data-markdown-separator="^Notes:">
					<script type="text/template">
						Интерполирование функции
						-------------------------

						Интерполирование - способ нахождения промежуточных
						значений величины по имеющемуся дискретному набору
						известных значений.

						Апроксимация функции - замена одной функции другой,
						более простой, значения которой приближены или равны
						изначальной.
					</script>
				</section>
				
				<section data-markdown data-markdown-separator="^Notes:">
					<script type="text/template">
						Интерполяционный многочлен Лагранжа
						-------------------------

						$$ 
							L(x) = \sum_{i=0}^{n} y_il_i(x),
						$$ где
						$$
							l_i(x) = \prod_{j=0, j \ne i}^{n} 
							\dfrac{x-x_j}{x_i-x_j}
						$$
					</script>
				</section>
				
				<section data-markdown data-markdown-separator="^Notes:">
					<script type="text/template">
						Интерполяционный многочлен Лагранжа
						-------------------------

						$$
							l_0 = \dfrac{x-x_1}{x_0-x_1} \cdot
								  \dfrac{x-x_2}{x_0-x_2} \cdot
								  \dfrac{x-x_3}{x_0-x_3}
						$$
						$$
							l_1 = \dfrac{x-x_0}{x_1-x_1} \cdot
								  \dfrac{x-x_2}{x_1-x_2} \cdot
								  \dfrac{x-x_3}{x_1-x_3}
						$$
						$$
							l_2 = \dfrac{x-x_0}{x_2-x_1} \cdot
								  \dfrac{x-x_1}{x_2-x_2} \cdot
								  \dfrac{x-x_3}{x_2-x_3}
						$$
						$$
							l_3 = \dfrac{x-x_0}{x_3-x_1} \cdot
								  \dfrac{x-x_1}{x_3-x_2} \cdot
								  \dfrac{x-x_2}{x_3-x_3}
						$$
					</script>
				</section>
				
				<section data-markdown data-markdown-separator="^Notes:">
					<script type="text/template">
						Геометрический смысл определённого интеграла
						-------------------------

						Геометрический смысл - это площадь
						криволинейной трапеции для неотрицательной
						и непрерывной функции, котрая расположена 
						в интервале между двумя прямыми.

					</script>
				</section>
				
				<section>
					<h2>Нахождение площади криволинейной трапеции</h2>
					<label for="func">$f(x)$</label>
					<input type="text" id="func">
					<label for="a">$a$</label>
					<input type="text" id="a">
					<label for="b">$b$</label>
					<input type="text" id="b">
					<input type="button" value="Посчитать площадь" id="getResult">
					<output id="result"></output>
					<div style="height: 400px" id="plot"></div>
				</section>
				
				<section>
					<h2>Игра 1. Угадай площадь</h2>
					<div id="game1">
						<label for="funcGame">$f(x)$</label>
						<input type="text"  id="funcGame">
						<label for="aGame">$a$</label>
						<input type="text"  id="aGame">
						<label for="bGame">$b$</label>
						<input type="text"  id="bGame">
						<input type="button" id="getResultGame" value="Показать график">
						<div id="plotGame" style="height:400px"></div>
						<label for="inputGame">Ваш ответ:</label>
						<input type="text" id="inputGame">
						<input type="button" id="check" value="Проверить результат">
						<output id="_resultGame"></output>
					</div>
				</section>
				
				<section>
					<h2>Игра 2. Найди котиков</h2>
					<table id="findCats">
						<tbody>
							<tr>
								<td></td>
								<td></td>
								<td></td>
								<td></td>
							</tr>
							<tr>
								<td></td>
								<td></td>
								<td></td>
								<td></td>
							</tr>
							<tr>
								<td></td>
								<td></td>
								<td></td>
								<td></td>
							</tr>
							<tr>
								<td></td>
								<td></td>
								<td></td>
								<td></td>
							</tr>
						</tbody>
					</table>
					<output id="winner2" style="display:none"></output>
					<button id="startGame2">Начать игру</button>
					<table id="scoreboard2" style="display:none">
						<tr>
							<td>
								<span>Игрок 1</span>
								<span id="score20">0</span> очков
							</td>
							<td id="who2">
								1
							</td>
							<td>
								<span>Игрок 2</span>
								<span id="score21">0</span> очков
							</td>
						</tr>
					</table>
				</section>
				
				<section>
					<h2>Игра 3. Найди интегралы</h2>
					<table id="findIntegrals">
						<tbody>
							<tr>
								<td></td>
								<td></td>
								<td></td>
								<td></td>
							</tr>
							<tr>
								<td></td>
								<td></td>
								<td></td>
								<td></td>
							</tr>
							<tr>
								<td></td>
								<td></td>
								<td></td>
								<td></td>
							</tr>
							<tr>
								<td></td>
								<td></td>
								<td></td>
								<td></td>
							</tr>
						</tbody>
					</table>
					<output id="winner3" style="display:none"></output>
					<button id="startGame3">Начать игру</button>
					<table id="scoreboard3" style="display:none">
						<tr>
							<td>
								<span>Игрок 1</span>
								<span id="score30">0</span> очков
							</td>
							<td id="who3">
								1
							</td>
							<td>
								<span>Игрок 2</span>
								<span id="score31">0</span> очков
							</td>
						</tr>
					</table>
				</section>
			</div>
		</div>

		<script src="plugin/underscore/underscore-min.js"></script>
		<script src="plugin/algebrite/algebrite.bundle-for-browser.js"></script>
		<script src="plugin/math.js/math.min.js"></script>
		<script src="plugin/plotly/plotly.min.js"></script>
		
		<script src="dist/reveal.js"></script>
		<script src="plugin/notes/notes.js"></script>
		<script src="plugin/markdown/markdown.js"></script>
		<script src="plugin/highlight/highlight.js"></script>

		<script>
			let resultGame;
			window.onload = () => {

				//Нахождение интеграла
				document.querySelector('#_getResult').onclick = () => {
					let a = document.querySelector('#_a').value;
					let b = document.querySelector('#_b').value;
					let d = document.querySelector('#_d').value;
					let func = document.querySelector('#_function').value;
					let result = document.querySelector('#_result');
					if (func === '') {
						return result.innerHTML = 'Вы не ввели функцию';
					}
					if (d === '') {
						return result.innerHTML = 'Вы не ввели переменную интерирования';
					}
					if (a === '' && b !== '') {
						return result.innerHTML = 'Вы не ввели нижний предел интегрирования';
					}
					if (a !== '' && b === '') {
						return result.innerHTML = 'Вы не ввели верхний предел интегрирования';
					}
					if (a !== '' && b !== '') {
						return result.innerHTML = Algebrite.defint(func, d, b, a);
					}
					return result.innerHTML = katex.renderToString(
						Algebrite.simplify(
							Algebrite.integral(func, d) + '+ C'
						).toLatexString()
					);
				}

				//Нахождение площади трапеции
				document.querySelector('#getResult').onclick = () => {
					let a = document.querySelector('#a').value;
					let b = document.querySelector('#b').value;
					let func = document.querySelector('#func').value;
					let result = document.querySelector('#result');
					if (func === '') {
						return result.innerHTML = 'Вы не ввели функцию';
					}
					if (a === '' && b !== '') {
						return result.innerHTML = 'Вы не ввели левую границу';
					}
					if (a !== '' && b === '') {
						return result.innerHTML = 'Вы не ввели правую границу';
					}
					if (a > b) {
						return result.innerHTML = 'Вы перепутали границы';
					}
					if (a === b) {
						return result.innerHTML = '0';
					}
					plot(
						'plot',
						document.querySelector('#func').value,
						document.querySelector('#a').value,
						document.querySelector('#b').value
					);
					return result.innerHTML = Algebrite.defint(func, 'x', b, a);
				}

				//Игра 1
				document.querySelector('#getResultGame').onclick = () => {
					let a = document.querySelector('#aGame').value;
					let b = document.querySelector('#bGame').value;
					let func = document.querySelector('#funcGame').value;
					let result = document.querySelector('#_resultGame');
					if (func === '') {
						return result.innerHTML = 'Вы не ввели функцию';
					}
					if (a === '' && b !== '') {
						return result.innerHTML = 'Вы не ввели левую границу';
					}
					if (a !== '' && b === '') {
						return result.innerHTML = 'Вы не ввели правую границу';
					}
					if (a > b) {
						return result.innerHTML = 'Вы перепутали границы';
					}
					plot(
						'plotGame',
						func,
						a,
						b
					);
					resultGame = Algebrite.defint(func, 'x', a, b);
				}
				document.querySelector('#check').onclick = () => {
					let check = 
						Algebrite.abs(
							Algebrite.run(
								`${document.querySelector("#inputGame").value}-${resultGame.toString()}`
							)
						).toString();
					if (check == 0) {
						return document.querySelector('#_resultGame').innerHTML = 'Вы угадали';
					}
					return document.querySelector('#_resultGame').innerHTML = 'Вы ошиблись на ' +  check;
				}

				//Построение графика
				const plot = (place, expr, a, b) => {
					const exprCompile = math.compile(expr);
					const aCompile = math.compile(a);
					const bCompile = math.compile(b);
					const xValues = math.range(+a, +b+.05, .05).toArray();
					const yValues = xValues.map(
						x => {
							return exprCompile.evaluate({x});
						}
					);
					const xValuesA = [a,a];
					const xValuesB = [b,b];
					const yValuesA = [0,exprCompile.evaluate({x:a})];
					const yValuesB = [0,exprCompile.evaluate({x:b})];
					const plot1 = {
						x: xValues,
						y: yValues,
						fill: 'tozeroy',
						type: 'scatter',
					}
					const plot2 = {
						x: xValuesA,
						y: yValuesA,
						type: 'line',
					}
					const plot3 = {
						x: xValuesB,
						y: yValuesB,
						type: 'line',
					}
					Plotly.newPlot(place, [plot1, plot2, plot3]);
				}

				//Список интегралов
				let integralList = [
					'0',
					'1',
					'x^n',
					'a^x',
					'1/x^2',
					'1/sqrt(x)',
					'1/x',
					'e^x',
					'sin(x)',
					'cos(x)',
					'tan(x)',
					'1/cos(x)^2',
					'1/sin(x)^2'
				];

				for (let i in integralList) {
					integralList[i] = [
						'\\int ' + Algebrite.run(`printlatex(${integralList[i]})`)+' dx',
						Algebrite.integral(integralList[i]).toLatexString()
					];
				}
				
				//Таблица интегралов
				const integralTable = (func) => {
					let note = document.querySelector('#integral-table .notes').innerHTML;
					let slide;
					for (let i in func) {
						if (i%7 === 0) {
							slide = document.createElement('section');
							if (i == 0) {
								slide.className = 'present';
							} else {
								slide.classList = 'future';
							}
							slide.innerHTML = '<h3>Таблица интегралов</h3>';
						}
						slide.innerHTML += '<p>'+katex.renderToString(func[i][0])+' = '+
							katex.renderToString(func[i][1])+'+C</p>';
						if (i%7 === 6 || func.length - i === 1) {
							slide.innerHTML += `<aside class="notes">${note}</aside>`;
							document.querySelector('#integral-table').appendChild(slide);
						}
					}
				}
				integralTable(integralList);

				//Матрица котов
				let findCatsName = [
					'1.png',
					'1.png',
					'2.png',
					'2.png',
					'3.png',
					'4.png',
					'4.png',
					'5.png',
					'5.png',
					'6.png',
					'6.png',
					'7.png',
					'7.png',
					'8.png',
					'8.png',
				];
				let score = [0,0];
				let who = 0;
				let start = false;
				let lastValue = undefined;

				let tds = document.querySelectorAll('#findCats td');
				let i = 0;
				for (let td of tds) {
					td.innerHTML = `<img data-active="0" data-id="${i++}"
						width="80px" height="60px" data-cats="" 
						src="img/0.jpg">`;
					td.firstChild.onclick = e => {
						if (!start){
							return;
						}
						if (e.target.dataset.active === '1') {
							return;
						}
						if (lastValue !== undefined) {
							if (lastValue.dataset.cats === e.target.dataset.cats) {
								score[who] += 1;
								document.querySelector('#score2'+who).innerHTML = score[who];
								lastValue = undefined;
								if (score[0]+score[1] === 8) {
									let winner = '';
									if (score[0] > score[1]) {
										winner = "Выйграл первый игрок";
									} else if (score[0] < score[1]) {
										winner = "Выйграл второй игрок"
									} else {
										winner = "Ничья";
									}
									document.querySelector('#winner2').innerHTML = winner;
									document.querySelector('#winner2').style.display = "block";
									document.querySelector('#scoreboard2').style.display = 'none';
									document.querySelector('#startGame2').style.display = 'inline';
									start = false;
								}
							} else {
								who = who === 1 ? 0 : 1;
								document.querySelector('#who2').innerHTML = who + 1;
								setTimeout (
									() => {
										let dataId = document.querySelector(`[data-id="${e.target.dataset.id}"]`);
										dataId.src = "img/0.jpg";
										dataId.dataset.active = 0;
										let dataId2 = document.querySelector(`[data-id="${lastValue.dataset.id}"]`);
										dataId2.src = "img/0.jpg";
										dataId2.dataset.active = 0;

									}, 1000
								);
							}
						} else {
							lastValue = e.target;
						}
						document.querySelector(`[data-id="${e.target.dataset.id}"]`).src = 
							'img/'+e.target.dataset.cats;
						document.querySelector(`[data-id="${e.target.dataset.id}"]`)
							.dataset.active = "1";
						
					}
				}
				document.querySelector("#startGame2").onclick = () => {
					document.querySelector('#startGame2').style.display = 'none';
					document.querySelector('#winner2').style.display = 'none';
					document.querySelector('#scoreboard2').style.display = 'table';
					start = true;
					score = [0, 0];
					document.querySelector('#score20').innerHTML = "0";
					document.querySelector('#score21').innerHTML = "0";
					findCatsName = _.shuffle(findCatsName);
					for (let i in findCatsName) {
						let dataId = document.querySelector(`[data-id="${i}"]`);
						dataId.src= "img/0.jpg";
						/// dataId.active = "0"; 
						dataId.dataset.active = "0";
						dataId.dataset.cats = findCatsName[i];
					}
				}
			}

		</script>

		<script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/
			Reveal.initialize({
				hash: true,
				center: false,
				slideNumber: true,
				math: {
					notificationsEnabled: true,
				},
				dependencies: [
					{
						src: 'plugin/math-katex/math-katex.js', 
						async: true,
						callback: () => {
							// // solve problem with katex 
							// let section = document.querySelectorAll('section script');
							// 	section.forEach( (item, i) => {
							// 		section[i].innerHTML = section[i].innerHTML
							// 			.replace(/\\/g,'\\\\')
							// 			.replace(/_/g,'\\_')
							// 			.replace(/\{/g,'\\\{')
							// 			.replace(/\}/g,'\\\}');
							// });
						},
					}],
				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
			});
		</script>
	</body>
</html>
